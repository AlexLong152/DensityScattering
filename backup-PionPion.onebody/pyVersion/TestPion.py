# -*- coding: utf-8 -*-

"""
@author: alexl
"""

import numpy as np
import PionScatLib as pl
from matplotlib import pyplot as plt
from matplotlib import rcParams

rcParams["text.usetex"] = True
rcParams["font.family"] = "serif"


def main():
    isospin = 1
    thetas = np.arange(0, 181, 5)
    sqrtS_list = [1162, 1298]
    piCharges = [-1, 1]
    fig, axes = plt.subplots(
        nrows=len(sqrtS_list),
        ncols=len(piCharges),
        figsize=(10, 8),
        sharex=True,
        sharey=False,
    )

    for i, sqrtS in enumerate(sqrtS_list):
        for j, piCharge in enumerate(piCharges):
            ax = axes[i, j]

            # replicate your printing logic
            print("\nPion Charge=", piCharge, "sqrtS=", sqrtS)
            print("  theta      CS       Mat CS      Ratio")
            print(24 * "--")

            ys = []
            ysExp = []
            data = getData(piCharge, sqrtS)
            for idx, theta in enumerate(thetas):
                x = np.cos(theta * np.pi / 180)
                CS = pl.getCS(sqrtS, x, isospin, piCharge)
                ys.append(CS)

                assert data[idx][0] == theta
                CS_website = data[idx][1]
                ysExp.append(CS_website)

                ratio = CS_website / CS
                print(f"{theta:7.2f} |{CS:9.4f}  |{CS_website:9.4f}|{ratio:9.4f}")

            # plot both theory and data on this subplot
            ax.scatter(thetas, ys, label=r"Values from SAID $\delta_{\alpha}$")
            ax.scatter(thetas, ysExp, label="SAID Reported Value", marker="^")
            ax.set_ylim([0, 1.2 * np.max(ysExp)])

            # title & labels
            sign = {1: "+", -1: "-"}[piCharge]
            target = {1: "Proton", -1: "Neutron"}[isospin]
            ax.set_title(
                f"$\\sqrt{{S}}={sqrtS}\\,\\mathrm{{MeV}}, \\; \\pi^{sign}$ scattering on {target}"
            )
            ax.set_xlabel("$\\theta$")
            ax.set_ylabel(
                "$\\mathrm{{d}} \\sigma /\\mathrm{{d}} \\Omega\\;  [\\mathrm{{mb}}]$"
            )

            ax.legend(loc="best")

    # tidy up layout and show once
    fig.tight_layout()
    plt.show()


def getData(piCharge, sqrtS):
    match (piCharge, sqrtS):
        case (-1, 1298):
            data = np.array(
                [
                    [0.000, 0.1425e01],
                    [5.000, 0.1780e02],
                    [10.000, 0.1839e01],
                    [15.000, 0.1307e01],
                    [20.000, 0.1286e01],
                    [25.000, 0.1294e01],
                    [30.000, 0.1289e01],
                    [35.000, 0.1270e01],
                    [40.000, 0.1237e01],
                    [45.000, 0.1192e01],
                    [50.000, 0.1135e01],
                    [55.000, 0.1068e01],
                    [60.000, 0.9926e00],
                    [65.000, 0.9112e00],
                    [70.000, 0.8268e00],
                    [75.000, 0.7430e00],
                    [80.000, 0.6638e00],
                    [85.000, 0.5934e00],
                    [90.000, 0.5359e00],
                    [95.000, 0.4949e00],
                    [100.000, 0.4734e00],
                    [105.000, 0.4736e00],
                    [110.000, 0.4963e00],
                    [115.000, 0.5413e00],
                    [120.000, 0.6072e00],
                    [125.000, 0.6914e00],
                    [130.000, 0.7905e00],
                    [135.000, 0.9001e00],
                    [140.000, 0.1016e01],
                    [145.000, 0.1132e01],
                    [150.000, 0.1245e01],
                    [155.000, 0.1349e01],
                    [160.000, 0.1441e01],
                    [165.000, 0.1516e01],
                    [170.000, 0.1571e01],
                    [175.000, 0.1606e01],
                    [180.000, 0.1617e01],
                ]
            )
        case (1, 1162):
            data = np.array(
                [
                    [0.000, 0.4950e01],
                    [5.000, 0.5556e02],
                    [10.000, 0.1464e01],
                    [15.000, 0.2024e01],
                    [20.000, 0.2871e01],
                    [25.000, 0.3263e01],
                    [30.000, 0.3380e01],
                    [35.000, 0.3344e01],
                    [40.000, 0.3222e01],
                    [45.000, 0.3057e01],
                    [50.000, 0.2878e01],
                    [55.000, 0.2706e01],
                    [60.000, 0.2560e01],
                    [65.000, 0.2454e01],
                    [70.000, 0.2399e01],
                    [75.000, 0.2406e01],
                    [80.000, 0.2480e01],
                    [85.000, 0.2627e01],
                    [90.000, 0.2849e01],
                    [95.000, 0.3145e01],
                    [100.000, 0.3514e01],
                    [105.000, 0.3950e01],
                    [110.000, 0.4446e01],
                    [115.000, 0.4993e01],
                    [120.000, 0.5581e01],
                    [125.000, 0.6196e01],
                    [130.000, 0.6826e01],
                    [135.000, 0.7455e01],
                    [140.000, 0.8070e01],
                    [145.000, 0.8655e01],
                    [150.000, 0.9195e01],
                    [155.000, 0.9679e01],
                    [160.000, 0.1009e02],
                    [165.000, 0.1043e02],
                    [170.000, 0.1067e02],
                    [175.000, 0.1082e02],
                    [180.000, 0.1087e02],
                ]
            )
        case (-1, 1162):
            data = np.array(
                [
                    [0.000, 0.1258e01],
                    [5.000, 0.1061e03],
                    [10.000, 0.1111e02],
                    [15.000, 0.4219e01],
                    [20.000, 0.2567e01],
                    [25.000, 0.1911e01],
                    [30.000, 0.1563e01],
                    [35.000, 0.1339e01],
                    [40.000, 0.1175e01],
                    [45.000, 0.1042e01],
                    [50.000, 0.9300e00],
                    [55.000, 0.8317e00],
                    [60.000, 0.7445e00],
                    [65.000, 0.6667e00],
                    [70.000, 0.5977e00],
                    [75.000, 0.5368e00],
                    [80.000, 0.4837e00],
                    [85.000, 0.4380e00],
                    [90.000, 0.3994e00],
                    [95.000, 0.3672e00],
                    [100.000, 0.3411e00],
                    [105.000, 0.3204e00],
                    [110.000, 0.3047e00],
                    [115.000, 0.2932e00],
                    [120.000, 0.2854e00],
                    [125.000, 0.2807e00],
                    [130.000, 0.2786e00],
                    [135.000, 0.2784e00],
                    [140.000, 0.2798e00],
                    [145.000, 0.2823e00],
                    [150.000, 0.2853e00],
                    [155.000, 0.2886e00],
                    [160.000, 0.2918e00],
                    [165.000, 0.2946e00],
                    [170.000, 0.2967e00],
                    [175.000, 0.2981e00],
                    [180.000, 0.2985e00],
                ]
            )
        case (1, 1298):
            data = np.array(
                [
                    [0.000, 0.1910e02],
                    [5.000, 0.6678e02],
                    [10.000, 0.2686e02],
                    [15.000, 0.2141e02],
                    [20.000, 0.1914e02],
                    [25.000, 0.1756e02],
                    [30.000, 0.1616e02],
                    [35.000, 0.1479e02],
                    [40.000, 0.1341e02],
                    [45.000, 0.1202e02],
                    [50.000, 0.1065e02],
                    [55.000, 0.9302e01],
                    [60.000, 0.8014e01],
                    [65.000, 0.6808e01],
                    [70.000, 0.5707e01],
                    [75.000, 0.4733e01],
                    [80.000, 0.3901e01],
                    [85.000, 0.3224e01],
                    [90.000, 0.2710e01],
                    [95.000, 0.2363e01],
                    [100.000, 0.2180e01],
                    [105.000, 0.2157e01],
                    [110.000, 0.2283e01],
                    [115.000, 0.2543e01],
                    [120.000, 0.2921e01],
                    [125.000, 0.3396e01],
                    [130.000, 0.3945e01],
                    [135.000, 0.4543e01],
                    [140.000, 0.5166e01],
                    [145.000, 0.5788e01],
                    [150.000, 0.6385e01],
                    [155.000, 0.6933e01],
                    [160.000, 0.7412e01],
                    [165.000, 0.7805e01],
                    [170.000, 0.8096e01],
                    [175.000, 0.8275e01],
                    [180.000, 0.8335e01],
                ]
            )
        case _:
            raise ValueError("oops")
    return data


if __name__ == "__main__":
    main()
